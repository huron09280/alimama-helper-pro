define("onebp/views/pages/main/crowd/util",[],function(g,F,D){var E=Object.defineProperty,P=l=>E(l,"__esModule",{value:!0}),A=(l,e)=>{P(l);for(var s in e)E(l,s,{get:e[s],enumerable:!0})};A(F,{default:()=>O});const _=l=>{var r,p;let e=((r=l==null?void 0:l.crowd)==null?void 0:r.label)||{},{labelName:s,optionList:t=[]}=e,a=T(e),n=Array.from(new Set(t==null?void 0:t.map(b=>b.optionName))).join("\uFF0C"),o=((p=l.crowd)==null?void 0:p.crowdName)||Array.from(new Set([s,n])).join("\uFF1A");return{...l,mx_crowdId:a,crowd:{...l.crowd||{},crowdName:o},showTagList:l.showTagList||e.showTagList}},T=l=>{var r;const{targetType:e,labelId:s,priceDimension:t,isMulti:a,optionList:n=[]}=l;let o="";if(t=="OPTION"||t=="LABEL"&&a){let p=n==null?void 0:n.map(b=>b.optionValue);o=`${e}_${s}_${(r=p==null?void 0:p.sort())==null?void 0:r.join("_")}`}else o=`${e}_${s}`;return o},m=l=>{var s;let e={};return(s=l==null?void 0:l.subComponentList)==null||s.forEach(t=>{var a,n,o;(a=t.subComponentList)!=null&&a.length?e[t.code]=(t.subComponentList||[]).map(r=>r.webType=="crowd_label"?{labelId:r.code,...r.properties||{}}:r.code):(n=t.properties)!=null&&n.proxyValue?e[t.name]=(o=t.properties)==null?void 0:o.proxyValue:e[t.name]=t.code}),e};var O={getMxCrowdId:T,fixCrowd:_,fixCrowdList:l=>(l||[]).map(e=>_(e)),crowd2label:l=>{let e=[];return(l||[]).forEach(s=>{var a;let t=((a=s.crowd)==null?void 0:a.label)||{};if(t.labelId){let n=t.optionList||[];e[t.labelId]&&n.length>0?e[t.labelId].options.push(...n):e[t.labelId]=t}}),Object.values(e)},label2crowd:(l,e)=>{let s=[];return(l||[]).forEach(t=>{var o;switch(`${e!=null?e:t.priceDimension}_${t.priceMode}`){case"OPTION_0":case"OPTION_1":case"OPTION_2":case"OPTION_-1":case"OPTION_3":let r=JSON.parse(JSON.stringify(t));delete r.optionList,(t.optionList||[]).forEach(p=>{var b;s.push(_({crowd:{targetType:t.targetType,label:{...r,optionList:[p]}},price:(b=p.price)!=null?b:{}}))});break;case"LABEL_0":case"LABEL_1":case"LABEL_-1":s.push(_({crowd:{targetType:t.targetType,label:t},price:(o=t.price)!=null?o:{}}));break}}),s},getProxyParams:m,getSystemParams:l=>{let e=[],s=t=>{t.forEach(a=>{if(a.code=="systemRecommend"){let n=m((a.subComponentList||[]).find(o=>o.code=="proxyParams"));e.push(n)}else s(a.subComponentList||[])})};return s(l.subComponentList||[]),e},getDisplayItems:l=>{const e=[],s=[],t={};let a=(n,o)=>{var r,p,b;if(n){n._parentId=(r=n._parentId)!=null?r:o,s.push(n);let f=m((n.subComponentList||[]).find(u=>u.code=="proxyParams"));(f.labelIdList||[]).forEach(u=>{t[u]=!0}),(f.labelList||[]).forEach(u=>{t[typeof u=="string"?u:u.labelId]=!0}),n._labelList=f.labelList||[],(p=n.properties)!=null&&p.displayType&&e.push(n),(b=n.subComponentList)==null||b.forEach(u=>{a(u,n.id)})}};return a(l,void 0),{displayTargets:e,allTargets:s,labelIdMap:t,labelIdList:Object.keys(t)}},checkShopCrowdFewer(l,e){var a,n,o;const[s]=this.findSubCompsByCode(l==null?void 0:l.subComponentList,"shopCrowdDiagnose");let t;if((a=s==null?void 0:s.properties)!=null&&a.isCompeteCrowd){const[r]=this.findSubCompsByCode(l==null?void 0:l.subComponentList,"compete"),{labelIdMap:p}=this.getDisplayItems(r),b=((n=e==null?void 0:e.filter(u=>{var h,i;return p[(i=(h=u==null?void 0:u.crowd)==null?void 0:h.label)==null?void 0:i.labelId]}))==null?void 0:n.length)||0,f=(e==null?void 0:e.length)&&b/(e==null?void 0:e.length)<=.1;t=r&&(b<=1||f)}else{const[r]=this.findSubCompsByCode(l==null?void 0:l.subComponentList,"shopCrowds"),[p]=this.findSubCompsByCode(l==null?void 0:l.subComponentList,"itemCrowds"),{labelIdMap:b}=this.getDisplayItems(r),{labelIdMap:f}=this.getDisplayItems(p),u=((o=e==null?void 0:e.filter(i=>{var y,d,I,C;return b[(d=(y=i==null?void 0:i.crowd)==null?void 0:y.label)==null?void 0:d.labelId]||f[(C=(I=i==null?void 0:i.crowd)==null?void 0:I.label)==null?void 0:C.labelId]}))==null?void 0:o.length)||0,h=(e==null?void 0:e.length)&&u/(e==null?void 0:e.length)<=.1;t=r&&p&&(u<=1||h)}return t},findSubCompsByCode(l=[],e){let s=[],t=(a,n)=>{let o=a.find(r=>r.code==n);if(o)s.push(o);else for(let r of a)if(r.subComponentList){let p=t(r.subComponentList,n);p&&s.push(p)}};return t(l,e),s},loopSubComponentList(l,e){let s=(t,a)=>{var n;(n=t==null?void 0:t.subComponentList)==null||n.forEach(o=>{a(o),s(o,a)})};s(l,e)},checkCompetingCrowdLimit(l,e){var o,r,p,b,f;const s=(o=l==null?void 0:l.subComponentList)==null?void 0:o.find(u=>u.code==="isCompeteLimit"),t=(r=s==null?void 0:s.subComponentList)==null?void 0:r.find(u=>u.code==="noLimit");let a=!1,n=[];return!t&&s&&((b=(p=s==null?void 0:s.properties)==null?void 0:p.limitList)==null||b.forEach(u=>{var i,y;const h=e==null?void 0:e.filter(d=>d.crowd.label.labelId==u.labelId);if(h!=null&&h.length){const d=(y=(i=h[0])==null?void 0:i.crowd)==null?void 0:y.label;if((h==null?void 0:h.length)<=u.min){const I=`\u4EB2\uFF0C\u7ADE\u4E89\u822A\u7EBF\u6240\u9009\u62E9\u7684\u3010${d.labelName}\u3011\u592A\u5C11\uFF0C\u6781\u53EF\u80FD\u5BFC\u81F4\u66DD\u5149\u8FC7\u5C11\u6548\u679C\u5DEE\uFF0C\u9700\u8981\u9009\u62E9${u.min}\u4E2A\u53CA\u4EE5\u4E0A`;h.forEach(C=>{C.deleteDisabled=!0,C.deleteDisabledTip=I}),(h==null?void 0:h.length)<u.min&&(n.push(I),a=!0)}else h.forEach(I=>{I.deleteDisabled=!1,I.deleteDisabledTip=null})}})),{hintCompeteLimit:a,msgs:n,anchorLabelId:(f=s==null?void 0:s.properties)==null?void 0:f.anchorLabelId}}}});

//# sourceMappingURL=https://sourcemap.def.alibaba-inc.com/sourcemap/mm/onebp/20260206.112445.109/onebp/views/pages/main/crowd/util.js.map
