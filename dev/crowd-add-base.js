define("onebp/views/pages/main/crowd/add-crowds/base",["magix","../util","./store","./constant"],function(p,R,ut){let S=p("magix");var B=Object.create,u=Object.defineProperty,k=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyNames,N=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,C=t=>u(t,"__esModule",{value:!0}),W=(t,o)=>{C(t);for(var s in o)u(t,s,{get:o[s],enumerable:!0})},V=(t,o,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of z(o))!U.call(t,e)&&e!=="default"&&u(t,e,{get:()=>o[e],enumerable:!(s=k(o,e))||s.enumerable});return t},f=t=>V(C(u(t!=null?B(N(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);W(R,{deleteTemplateList:()=>tt,dmpConvert:()=>K,getCrowdsCount:()=>Q,getCrowdsCountByLabels:()=>X,getData:()=>$,getDesc:()=>G,getDmpCrowdList:()=>H,getDmpProxyParamsFromAdc:()=>st,getProperties:()=>y,getTemplateList:()=>Y,getUv:()=>J,saveTemplate:()=>Z,sortFields:()=>rt,sortList:()=>ot,syncListSelected:()=>et,templateApi:()=>i,updateTemplate:()=>q});var h=f(S),l=f(p("../util")),m=f(p("./store")),v=f(p("./constant"));async function $(t={}){var _,x,D,O,g,I,b,E,T;const{isLabel:o,isPage:s,otherParams:e={},priceDimension:r}=t,{optionName:n,tabNode:a=t.tabNode,pageSize:L,offset:nt}=(D=(x=(_=this==null?void 0:this.updater)==null?void 0:_.get)==null?void 0:x.call(_))!=null?D:{},at=(b=(O=this==null?void 0:this.options)==null?void 0:O.proxyParams)!=null?b:((I=(g=this==null?void 0:this.updater)==null?void 0:g.get)==null?void 0:I.call(g,"proxyParams"))||{};let ct=(E=a==null?void 0:a.subComponentList)==null?void 0:E.find(c=>c.code==="proxyParams");const it={pageSize:L,offset:nt,optionName:n,...at,...e,...l.default.getProxyParams(ct)},dt=[{name:o?s?"label_findPage_post":"label_findList_post":"crowd_findRecommendCrowd_post",params:it}];try{const[c]=await this.fetch(dt);let P=c.get("data.list",[]),w=[],pt=c.get("data.count",0),F=[];return o?(F=P,w=l.default.label2crowd(P,r)):w=l.default.fixCrowdList(P),w.forEach(d=>{var j,M,A;(((j=d.price)==null?void 0:j.discount)==null||((M=d.price)==null?void 0:M.discount)==null)&&h.default.mix(d,{price:h.default.mix(d.price||{},{discount:(A=d.price)==null?void 0:A.fitDiscount})})}),{labelList:F,list:w,count:pt}}catch(c){return(T=this.alert)==null||T.call(this,"\u7CFB\u7EDF\u63D0\u793A",c.message||c.msg,null,{type:"error"}),{labelList:[],list:[],count:0}}}function y(t,o){var e,r,n;return(n=(o!=null?o:t.priceDimension)===v.PRICE_DIMENSION_LABEL?t==null?void 0:t.properties:(r=(e=t==null?void 0:t.optionList)==null?void 0:e[0])==null?void 0:r.properties)!=null?n:{}}function G(t){var s,e;return t.priceDimension===v.PRICE_DIMENSION_LABEL?t==null?void 0:t.labelDesc:(e=(s=t==null?void 0:t.optionList)==null?void 0:s[0])==null?void 0:e.optionDesc}function H(t,o){return m.default.crowdList.filter(e=>{var r;return((r=e.crowd.label)==null?void 0:r.labelId)==t}).map(e=>{var r,n,a;return{dmpCrowdId:(a=(n=(r=e.crowd.label)==null?void 0:r.optionList)==null?void 0:n[0])==null?void 0:a.optionValue,discount:o?e.price.discount:null}})}async function J(t){const{proxyParams:o}=this.options,e=[{name:"crowd_getPredictionUv_post",params:{...o,crowd:t}}],[r]=await this.fetch(e);return r.get("data",{})}async function K(t={}){const o=[{name:"label_dmpConvert_post",params:t}],[s]=await this.fetch(o);return s.get("data.list",[])}function Q(t){const{labelIdList:o}=l.default.getDisplayItems(t);return m.default.crowdList.filter(e=>o.findIndex(r=>{var n;return((n=e.crowd.label)==null?void 0:n.labelId)==r})!==-1).length}function X(t){return m.default.crowdList.filter(s=>(t==null?void 0:t.findIndex(e=>{var r;return((r=s.crowd.label)==null?void 0:r.labelId)==(e==null?void 0:e.labelId)}))!==-1).length}async function Y(t){return await i.call(this,"template_findList_post",{templateType:"CROWD",...t})}async function Z(t){return await i.call(this,"template_add_post",{templateType:"CROWD",...t})}async function q(t){return await i.call(this,"template_update_post",t)}async function tt(t){return await i.call(this,"template_delete_post",t)}async function i(t,o={}){const{proxyParams:s={}}=this.options;o.bizCode=s.bizCode;const e=[{name:t,params:o}],[r]=await this.fetch(e);return r.get("data",{})}function et(t=[],o){var s;for(const e of t){const r=m.default.crowdList.find(n=>(n==null?void 0:n.mx_crowdId)===(e==null?void 0:e.mx_crowdId));e.selected=!!r,o&&r&&(e.price.discount=(s=r.price)==null?void 0:s.discount)}return t}function ot(t){const{orderField:o,orderBy:s}=this.updater.get();return t.sort((e,r)=>{const n=y(e.crowd.label),a=y(r.crowd.label);return s==="asc"?(n==null?void 0:n[o])-(a==null?void 0:a[o]):(a==null?void 0:a[o])-(n==null?void 0:n[o])}),t}function rt(t){var e;const{orderField:o,orderBy:s}=this.updater.get();for(const r of t)r.properties.order=((e=r.properties)==null?void 0:e.key)===o?s:"";return t}function st(t){var e,r;const o=(e=t==null?void 0:t.subComponentList)==null?void 0:e.find(n=>(n==null?void 0:n.code)==="dmpProxyParams"),s={};return(r=o==null?void 0:o.subComponentList)==null||r.forEach(n=>{var a;s[n.code]=(a=n.subComponentList)==null?void 0:a.map(L=>L.code)}),s}});

//# sourceMappingURL=https://sourcemap.def.alibaba-inc.com/sourcemap/mm/onebp/20260206.112445.109/onebp/views/pages/main/crowd/add-crowds/base.js.map
