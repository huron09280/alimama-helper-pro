# 阿里妈妈多合一助手 - 回归验收清单

适用版本：`v5.23`（当前工作区实现）

## 1. 语法与加载

1. 执行语法检查：
- `node --check "阿里妈妈多合一助手.js"`
- `node --check "alimama-auto-optimizer.user.js"`

2. 浏览器中安装/更新脚本后刷新阿里妈妈页面：
- 右侧显示主助手悬浮球
- 点击可展开主助手面板

## 2. 安全验证

1. 日志区安全
- 在控制台执行：
```js
window.console.log('[AM] <img src=x onerror=alert(1)>')
```
- 预期：日志区只显示文本，不执行脚本。

2. 下载弹窗安全
- 触发下载拦截后检查弹窗：
  - 链接可正常点击下载
  - 链接 DOM 包含 `rel="noopener noreferrer"`
- 用非法协议 URL（如 `javascript:alert(1)`）模拟数据时：
  - 不生成可点击下载链接
  - 控制台仅出现一次 debug 跳过提示

## 3. 性能验证

1. 高频请求场景
- 页面大量请求时，拦截器仅处理文本/JSON响应，二进制响应应跳过。

2. 大响应跳过
- 对大于 1MB 的响应，控制台出现“超过限制跳过解析”提示，页面不卡顿。

3. DOM 高频更新
- 切换筛选、翻页、Tab 时无明显卡顿，计算仍持续更新。

## 4. 功能回归

1. 计算指标
- 询单成本、加购成本、潜客占比、花费占比、预算进度均显示正确。

2. 排序逻辑
- 开启“花费排序”后，首次自动降序。
- 切换 Tab 后自动重置并重新降序。
- 页面路由变化后自动重置并重新降序。

3. 弹窗速闭
- 遇到遮罩/弹窗时可自动关闭，日志有记录。

4. 算法护航
- 点击“算法护航”后主面板自动最小化。
- 护航面板可打开、可触发扫描执行。
- Token 状态点随 token 就绪状态变化（绿/红）。

## 5. 配置与迁移

1. 主配置持久化
- 修改开关后刷新页面，状态应保留（`AM_HELPER_CONFIG`）。

2. 旧 key 迁移
- 预置 `AM_HELPER_CONFIG_V5_15` 后刷新页面：
  - 新 key `AM_HELPER_CONFIG` 自动生成
  - 功能开关继承旧配置

## 6. 文档一致性

1. `README.md` 不再包含 `file://` 绝对路径。
2. `README.md`、`CLAUDE.md`、`KNOWLEDGE.md` 均对齐到：
- 当前版本 `v5.23`
- 双 IIFE 架构
- 统一 Hook 与配置 key `AM_HELPER_CONFIG`
